package decoderbufs;

option java_package="io.debezium.connector.postgresql.proto";
option java_outer_classname = "PgProto";
option optimize_for = SPEED;

enum Op {
    UNKNOWN = -1;
    INSERT = 0;
    UPDATE = 1;
    DELETE = 2;
    BEGIN  = 3;
    COMMIT = 4;
}

message Point {
    required double x = 1;
    required double y = 2;
}

message ColMessage {
    optional string column_name = 1;
    optional int64 column_type = 2;
    oneof data {
      int32 data_int32 = 3;
      int64 data_int64 = 4;
      float data_float = 5;
      double data_double = 6;
      bool data_bool = 7;
      string data_string = 8;
      bytes data_bytes = 9;
      Point data_point = 10;
      bool data_missing = 11;
    }
}

message TypeInfo {
    required string modifier = 1;
    required bool value_optional = 2;
}

message RowMessage {
    optional uint32 transaction_id = 1;
    optional uint64 commit_time = 2;
    optional string table = 3;
    optional Op op = 4;
    repeated ColMessage new_tuple = 5;
    repeated ColMessage old_tuple = 6;
    repeated TypeInfo new_typeinfo = 7;
}